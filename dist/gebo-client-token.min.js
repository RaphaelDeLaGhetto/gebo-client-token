/*! gebo-client-token - v0.0.2 - 2013-11-18
* Copyright (c) 2013 ; Licensed  */
!function(){"use strict";angular.module("gebo-client-token",["ngRoute","ngResource"]).factory("Token",["$http","$q","$window","$rootScope","$resource","$filter",function(a,b,c,d,e,f){function g(c){var d=b.defer();return c.access_token=p(),a.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",a.post(i("request"),c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise}function h(a){var b="";for(var c in a)0!==b.length&&(b+="&"),b+=c+"="+f("json")(a[c]);return b}function i(a){return m.gebo+m[a]}var j={},k="token",l={},m={gebo:l,redirect:l,clientId:l,clientName:l,authorize:"/dialog/authorize",verify:"/verify",request:"/request",propose:"/propose",inform:"/inform",localStorageName:l,scopes:""},n=function(){var a=[];if(angular.forEach(m,function(b,c){(b===l||void 0===b)&&a.push(c)}),a.length)throw new Error("Token is insufficiently configured. Please configure the following options: "+a.join(", "));return{response_type:k,client_id:m.clientId,client_name:m.clientName,redirect_uri:m.redirect,scope:m.scopes}},o=function(a){m=angular.extend(m,a)},p=function(){return localStorage.getItem(m.localStorageName)},q=function(a){localStorage.setItem(m.localStorageName,a)},r=function(){j={},localStorage.removeItem(m.localStorageName)},s=function(a,e){e=angular.extend({name:"AuthPopup",openParams:{width:650,height:300,resizable:!0,scrollbars:!0,status:!0}},e);var f=b.defer(),g=angular.extend(n(),a),h=i("authorize")+"?"+t(g),j=function(a){var b=[];return angular.forEach(a,function(a,c){(a||0===a)&&(a=a===!0?"yes":a,b.push(c+"="+a))}),b.join(",")},k=window.open(h,e.name,j(e.openParams));return angular.element(c).bind("message",function(a){a.source===k&&a.origin===window.location.origin&&d.$apply(function(){a.data.access_token?f.resolve(a.data):f.reject(a.data)})}),f.promise},t=function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},u=function(c){var d=b.defer();return a.get(i("verify")+"?access_token="+c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise};return{clear:r,data:function(){return j},formEncode:h,get:p,getEndpoints:function(){return m},getEndpointUri:i,getParams:n,getTokenByPopup:s,objectToQueryString:t,verify:u,request:g,set:q,setEndpoints:o}}])}(),function(a){"use strict";angular.module("gebo-client-token").controller("CallbackCtrl",["$scope","$location",function(b,c){function d(a){var b,c,d={};return angular.forEach((a||"").split("&"),function(a){a&&(b=a.split("="),c=decodeURIComponent(b[0]),d[c]=angular.isDefined(b[1])?decodeURIComponent(b[1]):!0)}),d}var e=c.path().substring(1),f=d(e);a.opener.postMessage(f,"*"),a.close()}])}(window);