/*! gebo-client-token - v0.0.16 - 2014-08-15
* Copyright (c) 2014 ; Licensed  */
!function(){"use strict";angular.module("gebo-client-token",["ngRoute","ngResource"]).factory("Token",["$http","$q","$window","$rootScope","$resource","$filter",function(a,b,c,d,e,f){function g(c){var d=b.defer();return c instanceof FormData?(c.append("access_token",r()),a.post(i("perform"),c,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){d.resolve(a)}).error(function(a,b){d.reject({code:b,message:a})})):(c.access_token=r(),a.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",a.post(i("perform"),c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject({code:b,message:a})})),d.promise}function h(a){var b="";for(var c in a)0!==b.length&&(b+="&"),b+=c+"="+f("json")(a[c]);return b}function i(a){return o.gebo+o[a]}function j(c){var d=b.defer();return c.access_token=r(),a.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",a.post(i("send"),c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise}function k(){var c=b.defer();return a.get(i("logout")).success(function(a){c.resolve(a)}).error(function(a,b){c.reject(b)}),c.promise}var l={},m="token",n={},o={gebo:n,redirect:n,clientId:n,clientName:n,authorize:"/dialog/authorize",verify:"/verify",perform:"/perform",send:"/send",logout:"/logout",localStorageName:n,scopes:""},p=function(){var a=[];if(angular.forEach(o,function(b,c){(b===n||void 0===b)&&a.push(c)}),a.length)throw new Error("Token is insufficiently configured. Please configure the following options: "+a.join(", "));return{response_type:m,client_id:o.clientId,client_name:o.clientName,redirect_uri:o.redirect,scope:o.scopes}},q=function(a){o=angular.extend(o,a)},r=function(){return localStorage.getItem(o.localStorageName)},s=function(a){localStorage.setItem(o.localStorageName,a)},t=function(){l={},localStorage.removeItem(o.localStorageName)},u=function(a,e){e=angular.extend({name:"AuthPopup",openParams:{width:650,height:300,resizable:!0,scrollbars:!0,status:!0}},e);var f=b.defer(),g=angular.extend(p(),a),h=i("authorize")+"?"+v(g),j=function(a){var b=[];return angular.forEach(a,function(a,c){(a||0===a)&&(a=a===!0?"yes":a,b.push(c+"="+a))}),b.join(",")},k=window.open(h,e.name,j(e.openParams));return angular.element(c).bind("message",function(a){a.source===k&&a.origin===window.location.origin&&d.$apply(function(){a.data.access_token?f.resolve(a.data):f.reject(a.data)})}),f.promise},v=function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},w=function(c){var d=b.defer();return a.get(i("verify")+"?access_token="+c).success(function(a){l=a,d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise};return{clear:t,agent:function(){return l},formEncode:h,get:r,getEndpoints:function(){return o},getEndpointUri:i,getParams:p,getTokenByPopup:u,logout:k,objectToQueryString:v,perform:g,verify:w,send:j,set:s,setEndpoints:q}}])}(),function(a){"use strict";angular.module("gebo-client-token").controller("CallbackCtrl",["$scope","$location",function(b,c){function d(a){var b,c,d={};return angular.forEach((a||"").split("&"),function(a){a&&(b=a.split("="),c=decodeURIComponent(b[0]),d[c]=angular.isDefined(b[1])?decodeURIComponent(b[1]):!0)}),d}var e=c.path().substring(1),f=d(e);a.opener.postMessage(f,"*"),a.close()}])}(window);