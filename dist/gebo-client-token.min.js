/*! gebo-client-token - v0.0.8 - 2013-12-09
* Copyright (c) 2013 ; Licensed  */
!function(){"use strict";angular.module("gebo-client-token",["ngRoute","ngResource"]).factory("Token",["$http","$q","$window","$rootScope","$resource","$filter",function(a,b,c,d,e,f){function g(c){var d=b.defer();return c.access_token=q(),a.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",a.post(i("perform"),c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise}function h(a){var b="";for(var c in a)0!==b.length&&(b+="&"),b+=c+"="+f("json")(a[c]);return b}function i(a){return n.gebo+n[a]}function j(c){var d=b.defer();return c.access_token=q(),a.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded",a.post(i("send"),c).success(function(a){d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise}var k={},l="token",m={},n={gebo:m,redirect:m,clientId:m,clientName:m,authorize:"/dialog/authorize",verify:"/verify",perform:"/perform",send:"/send",localStorageName:m,scopes:""},o=function(){var a=[];if(angular.forEach(n,function(b,c){(b===m||void 0===b)&&a.push(c)}),a.length)throw new Error("Token is insufficiently configured. Please configure the following options: "+a.join(", "));return{response_type:l,client_id:n.clientId,client_name:n.clientName,redirect_uri:n.redirect,scope:n.scopes}},p=function(a){n=angular.extend(n,a)},q=function(){return localStorage.getItem(n.localStorageName)},r=function(a){localStorage.setItem(n.localStorageName,a)},s=function(){k={},localStorage.removeItem(n.localStorageName)},t=function(a,e){e=angular.extend({name:"AuthPopup",openParams:{width:650,height:300,resizable:!0,scrollbars:!0,status:!0}},e);var f=b.defer(),g=angular.extend(o(),a),h=i("authorize")+"?"+u(g),j=function(a){var b=[];return angular.forEach(a,function(a,c){(a||0===a)&&(a=a===!0?"yes":a,b.push(c+"="+a))}),b.join(",")},k=window.open(h,e.name,j(e.openParams));return angular.element(c).bind("message",function(a){a.source===k&&a.origin===window.location.origin&&d.$apply(function(){a.data.access_token?f.resolve(a.data):f.reject(a.data)})}),f.promise},u=function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},v=function(c){var d=b.defer();return a.get(i("verify")+"?access_token="+c).success(function(a){k=a,d.resolve(a)}).error(function(a,b){d.reject(b)}),d.promise};return{clear:s,agent:function(){return k},formEncode:h,get:q,getEndpoints:function(){return n},getEndpointUri:i,getParams:o,getTokenByPopup:t,objectToQueryString:u,perform:g,verify:v,send:j,set:r,setEndpoints:p}}])}(),function(a){"use strict";angular.module("gebo-client-token").controller("CallbackCtrl",["$scope","$location",function(b,c){function d(a){var b,c,d={};return angular.forEach((a||"").split("&"),function(a){a&&(b=a.split("="),c=decodeURIComponent(b[0]),d[c]=angular.isDefined(b[1])?decodeURIComponent(b[1]):!0)}),d}var e=c.path().substring(1),f=d(e);a.opener.postMessage(f,"*"),a.close()}])}(window);